var searchCache=null,searchCacheKey="search_cache_v1",searchFunc=function(e,t,n,r,a){function c(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function s(e){var s=document.getElementById(r);if(s&&!s._searchInitialized){s._searchInitialized=!0;var i=document.getElementById(a),h=document.getElementById(n);s.addEventListener("input",function(){var n=[],r=function(e){const t=[];for(let n=0;n<e.length;n++)for(let r=n+1;r<=Math.min(n+3,e.length);r++)t.push(e.slice(n,r).join(" "));return t}(this.value.trim().toLowerCase().split(" ")).sort(function(e,t){return t.split(" ").length-e.split(" ").length});if(i.innerHTML="",this.value.trim().length<=0)h.setAttribute("searching","false");else if(h.setAttribute("searching","true"),e.forEach(function(e){if(e.content?.trim().length&&(!t||e.path.includes(t))){var a=0,s=e.title?.trim()||"Untitled",i=s.toLowerCase(),h=e.content,l=h.toLowerCase(),o=e.path.startsWith("//")?e.path.slice(1):e.path;o=(o=o.replace(/\/?index\.html$/,"/")).replace(/\.html$/,"/");var u=-1,p=-1,f=-1;if(r.forEach(function(e){u=i.indexOf(e),p=l.indexOf(e),(u>=0||p>=0)&&(a+=1,p<0&&(p=0),f<0&&(f=p))}),a>0){const e=document.createElement("li"),t=document.createElement("a");t.href=o;const i=document.createElement("span");if(i.className="search-result-title",i.textContent=s,t.appendChild(i),f>=0){var d=Math.max(0,f-20),m=Math.min(h.length,f+80);0===d&&(m=100);var g=h.substring(d,m),v=new RegExp(r.map(c).join("|"),"gi");g=g.replace(v,function(e){return'<span class="search-keyword">'+e+"</span>"});const e=document.createElement("p");e.className="search-result-content",e.innerHTML=g+"...",t.appendChild(e)}e.appendChild(t),n.push({rank:a,element:e})}}}),n.length){n.sort(function(e,t){return t.rank-e.rank});const e=document.createElement("ul");e.className="search-result-list",n.forEach(function(t){e.appendChild(t.element)}),i.innerHTML="",i.appendChild(e)}})}}if(searchCache)s(searchCache);else{const e=setInterval(()=>{searchCache&&(clearInterval(e),s(searchCache))},100)}};utils.jq(()=>{!function(){var e=ctx.search.path;e.startsWith("/")&&(e=e.substring(1)),e=ctx.root+e;try{var t=localStorage.getItem(searchCacheKey);t&&(searchCache=JSON.parse(t))}catch(e){console.warn("搜索缓存解析失败",e)}fetch(e).then(e=>e.json()).then(e=>{searchCache=e;try{localStorage.setItem(searchCacheKey,JSON.stringify(e))}catch(e){console.warn("搜索缓存写入失败",e)}})}();var e=$("input#search-input");if(0==e.length)return;var t=document.querySelector("div#search-result");e.focus(function(){var t=ctx.search.path;t.startsWith("/")&&(t=t.substring(1)),t=ctx.root+t;const n=e.attr("data-filter")||"";searchFunc(t,n,"search-wrapper","search-input","search-result")}),e.keydown(function(e){13==e.which&&e.preventDefault()});new MutationObserver(function(e){const n=t.querySelector(".search-result-list li");$(".search-wrapper").toggleClass("noresult",!n)}).observe(t,{childList:!0,subtree:!0})});